{% extends 'base.html' %}

{% block main %}
<div class="wrapper">
  
  <!--I think this part should remain the same, so every page looks similar-->
    <header class="header">
        <ul class="navigation">
            <!-- Navigation buttons -->
          <li><a href="#">motaverse</a></li>

          <!-- 
          <li><a href="#">My Profile</a></li>
          <li><a href="#">About</a></li>
           -->
          <li><button onclick="simple_action('{{ url_for('admin_signout') }}')">Logout</button></li>
        </ul>
      </header>


  <!-- This is the left side of the screen-->
  <aside class="aside left-side">

    <!-- This is the profile picture and name of the current user-->
    <div class="profile-picture-container">
      <img src="{{ current_user_profile_pic_url }}" alt="Profile Picture">
    </div>
    <div class="user-name">{{ current_user_display_name  }}</div>


    <h2>Create new post</h2>
    <form action="{{ url_for('save_post') }}" method="post">
      <textarea id="newPostContent" name="newPostContent" rows="4" cols="50" placeholder="What's on your mind?"></textarea>
      <br/>
      <button type="submit">Post</button>
    </form>
  </aside>
    
  <!-- Shows posts -->
  <article class="main">
    <h1>Posts</h1>
    <ul class="post-container">
        <!-- this is where the post begins-->

<!-- Current user posts -->
{% if posts %}
  {% for post in posts %}
    <li class="post-item">
      <div class="profile">
        <!-- ... (post details) ... -->
      </div>
      <div class="post-content">
        {{ post.content }}
      </div>
      <div class="post-likes">
        Likes: {{ post.count_likes() }}
      </div>
      <div class="post-actions">
        <form action="{{ url_for('like_post') }}" method="POST">
          <!-- ... (like button) ... -->
        </form>
        <button type="button" class="comment-button">Comment</button>
      </div>

      <!-- Display up to two comments initially -->
      <div class="post-comments" data-post-id="{{ post.id }}">
        <ul>
          {% for comment in post.comments[:2] %}
            <li>
              <div class="comment">
                <span class="comment-author">{{ comment.user.name }}</span>: {{ comment.content }}
              </div>
            </li>
          {% endfor %}
        </ul>
      </div>

      <!-- Show more comments button -->
      {% if post.comments|length > 2 %}
        <button class="show-more-comments-btn" data-post-id="{{ post.id }}">Show More Comments</button>
      {% endif %}

      <!-- Comment input box and send button -->
      <div class="comment-input-box" style="display: none;">
        <textarea rows="3" cols="50" placeholder="Type your comment..." class="comment-input"></textarea>
        <button type="button" class="send-comment-button">Send</button>
      </div>
    </li>
  {% endfor %}
{% endif %}


    </ul>      <!-- end of posts section -->
    <script>
      // JavaScript to handle showing more comments
      document.addEventListener('DOMContentLoaded', function () {
        const showMoreButtons = document.querySelectorAll('.show-more-comments-btn');
    
        showMoreButtons.forEach(button => {
          button.addEventListener('click', function () {
            const postId = this.getAttribute('data-post-id');
            const commentContainer = document.querySelector(`[data-post-id="${postId}"] .post-comments ul`);
    
            // Assuming you have a route to fetch more comments for a specific post
            // You can use fetch API or any other method to retrieve more comments
            // and append them to the comment container
    
            // Example using fetch:
            fetch(`/get_more_comments?post_id=${postId}`)
              .then(response => response.json())
              .then(data => {
                // Append the new comments to the comment container
                data.comments.forEach(comment => {
                  const li = document.createElement('li');
                  li.innerHTML = `<div class="comment"><span class="comment-author">${comment.user.name}</span>: ${comment.content}</div>`;
                  commentContainer.appendChild(li);
                });
    
                // Remove the "Show More Comments" button if no more comments
                if (data.comments.length < 2) {
                  button.style.display = 'none';
                }
              })
              .catch(error => console.error('Error fetching more comments:', error));
          });
        });
      });
    </script>
  </article>    <!--    end of center section -->

  <script>
    // JavaScript to handle showing/hiding the comment input box
    document.addEventListener('DOMContentLoaded', function () {
      const commentButtons = document.querySelectorAll('.comment-button');
      const commentInputBoxes = document.querySelectorAll('.comment-input-box');
  
      commentButtons.forEach((button, index) => {
        button.addEventListener('click', function () {
          // Toggle display of the comment input box
          const commentInputBox = commentInputBoxes[index];
          commentInputBox.style.display = commentInputBox.style.display === 'none' ? 'block' : 'none';
        });
      });
    });
  </script>
  
        <!-- Where all the profiles are being displayed -->

    <aside class="aside aside-2">
      
      <h2>Profiles</h2>

      <div class="profile-list">
        {% for user in all_users %}
          <div class="profile-card">
            <img src="{{ url_for('static', filename='pic/' + user.profile_picture) }}" alt="Profile Picture" class="profile-pic-small">
            <div class="profile-name-small">{{ user.name }}</div>
          </div>
        {% endfor %}
      </div>
    </aside>
    
  <!-- Footer -->
    
    
    
</div>

<script type="text/javascript">
    function simple_action(target) {
        window.location = target
    }

    function confirmed_action(target) {
        if (confirm('Are you sure?')) {
            window.location = target
        }
    }
</script>
{% endblock %}
